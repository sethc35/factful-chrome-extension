class y{static async collectTextFromRects(){const e=document.querySelectorAll("div.kix-canvas-tile-content > svg");let c="",a=!0;return e.forEach(g=>{g.querySelectorAll("g[role='paragraph']").forEach(p=>{const t=p.querySelectorAll("rect");if(t.length===0)return;a||(c+=`
`),a=!1;let o="";t.forEach((i,n)=>{const l=i.getAttribute("aria-label")||"";if(n>0){const r=t[n-1];y.areRectsTouching(r,i)||(o+=" ")}o+=l}),c+=o})}),c.trim()}static areRectsTouching(e,c){const a=parseFloat(e.getAttribute("x"))+parseFloat(e.getAttribute("width")),g=parseFloat(c.getAttribute("x")),x=g+parseFloat(c.getAttribute("width")),p=parseFloat(e.getAttribute("x"));return Math.abs(a-g)<.01||Math.abs(x-p)<.01}static async fetchDataFromApi(){try{const e=await y.collectTextFromRects(),c=encodeURIComponent(e),a=await fetch(`https://backend.factful.io/process_text?input=${c}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.json()||{}}catch(e){return{error:e.message}}}static findCorrectionsInDocument(e,c){var p;const a=[];if(!((p=e==null?void 0:e.corrections)!=null&&p.length))return a;function g(t){const o=parseFloat(t.getAttribute("x"))||0,i=parseFloat(t.getAttribute("y"))||0,n=t.getAttribute("transform");let l=0,r=0;if(n){const s=n.match(/matrix\(.*?,.*?,.*?,.*?,(.*?),(.*?)\)/);s&&(l=parseFloat(s[1])||0,r=parseFloat(s[2])||0)}return{x:o+l,y:i+r,width:parseFloat(t.getAttribute("width"))||0,height:parseFloat(t.getAttribute("height"))||0}}function x(t,o){const i=[];let n=0;return document.querySelectorAll("div.kix-canvas-tile-content > svg").forEach(r=>{r.querySelectorAll("g[role='paragraph'], g[data-section-type='body']").forEach(h=>{h.querySelectorAll("rect").forEach(u=>{const f=u.getAttribute("aria-label")||"";if(!f)return;const d=n+f.length;if(n<o&&d>t){const b=g(u);i.push({rectElement:u,text:f,startCharIndex:n,endCharIndex:d,svgElement:r,paragraph:h,position:b})}n+=f.length})})}),i.sort((r,s)=>Math.abs(r.position.y-s.position.y)<1?r.position.x-s.position.x:r.position.y-s.position.y)}for(const t of e.corrections){const o=t.original_text,i=t.corrected_text,n=t.error_type,l=t.citations;let r=c.indexOf(o),s,h;if(r!==-1)s=r,h=r+o.length;else{const u=c.toLowerCase(),f=o.toLowerCase(),d=u.indexOf(f);if(d!==-1)s=d,h=d+o.length;else continue}const m=x(s,h);if(m.length>0){const u={start:s,end:h,corrected_text:i,error_type:n,matchingRects:m,originalText:o};n==="Factuality"&&l&&Array.isArray(l)?u.citations=l:u.citations=[],a.push(u)}}return a}static async processCommand(e,c){return null}}export{y as ApiService};
