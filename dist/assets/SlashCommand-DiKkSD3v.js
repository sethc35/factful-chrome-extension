class we{constructor(){this.isActive=!1,this.currentInput="",this.selectedIndex=0,this.slashCommands={"/synonym":{description:"Get synonyms for a word",parameters:[{name:"word",type:"text",description:"Word to find synonyms for"}]},"/antonym":{description:"Get antonyms for a word",parameters:[{name:"word",type:"text",description:"Word to find antonyms for"}]},"/search":{description:"Get a search for a question",parameters:[{name:"word",type:"text",description:"Query to search"}]}},this.slashCommandUI=document.createElement("div"),this.slashCommandUI.style.position="fixed",this.slashCommandUI.style.backgroundColor="#ffffff",this.slashCommandUI.style.border="1px solid #e0e0e0",this.slashCommandUI.style.borderRadius="8px",this.slashCommandUI.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.1)",this.slashCommandUI.style.padding="8px 0",this.slashCommandUI.style.zIndex="999999",this.slashCommandUI.style.display="none",this.slashCommandUI.style.maxHeight="200px",this.slashCommandUI.style.overflowY="auto",this.slashCommandUI.style.minWidth="200px",this.slashCommandUI.style.pointerEvents="auto",document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(this.slashCommandUI)}):document.body.appendChild(this.slashCommandUI),this.parameterUI=document.createElement("div"),this.parameterUI.style.position="absolute",this.parameterUI.style.backgroundColor="#ffffff",this.parameterUI.style.border="1px solid #e0e0e0",this.parameterUI.style.borderRadius="8px",this.parameterUI.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.1)",this.parameterUI.style.padding="12px",this.parameterUI.style.zIndex="9999999",this.parameterUI.style.display="none",document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(this.parameterUI)}):document.body.appendChild(this.parameterUI),document.addEventListener("keydown",o=>{this.isActive&&(o.key==="ArrowUp"?(this.updateSelectedIndex(-1),o.preventDefault()):o.key==="ArrowDown"&&(this.updateSelectedIndex(1),o.preventDefault()))})}waitForLoad(o){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(o)}):document.body.appendChild(o)}updateSelectedIndex(o){const t=this.slashCommandUI.children;this.selectedIndex=(this.selectedIndex+o+t.length)%t.length,Array.from(t).forEach((e,n)=>{e.style.backgroundColor=n===this.selectedIndex?"#f3f4f6":"transparent"})}selectCommand(o){this.insertCommandBadge(o),this.hideSlashCommandUI()}hideSlashCommandUI(){this.isActive=!1,this.currentInput="",this.selectedIndex=0,this.slashCommandUI.style.display="none",this.parameterUI.style.display="none"}createSlashCommandOption(o,t){const e=document.createElement("div");e.style.padding="8px 16px",e.style.cursor="pointer",e.style.display="flex",e.style.alignItems="center",e.style.gap="8px";const n=document.createElement("span");n.style.fontWeight="600",n.style.color="#2196F3",n.textContent=o;const r=document.createElement("span");return r.style.color="#666666",r.style.fontSize="12px",r.textContent=t,e.appendChild(n),e.appendChild(r),e.addEventListener("mouseover",()=>{e.style.backgroundColor="#f5f5f5"}),e.addEventListener("mouseout",()=>{e.style.backgroundColor="transparent"}),e.addEventListener("click",()=>this.selectCommand(o)),e}showSlashCommands(o,t=""){for(;this.slashCommandUI.firstChild;)this.slashCommandUI.removeChild(this.slashCommandUI.firstChild);const e=Object.entries(this.slashCommands).filter(([n])=>n.toLowerCase().includes((t||"").toLowerCase()));e.forEach(([n,r])=>{const m=this.createSlashCommandOption(n,r.description);this.slashCommandUI.appendChild(m)}),e.length>0?(this.slashCommandUI.style.position="fixed",this.slashCommandUI.style.display="block",this.slashCommandUI.style.left=`${o.left}px`,this.slashCommandUI.style.top=`${o.bottom+5}px`):this.slashCommandUI.style.display="none"}createSpinner(){const o=document.createElement("span");o.className="inline-spinner";const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","14"),t.setAttribute("height","14"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.verticalAlign="middle";const e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx","12"),e.setAttribute("cy","12"),e.setAttribute("r","10"),e.setAttribute("stroke","#999"),e.setAttribute("stroke-width","4"),e.setAttribute("stroke-dasharray","31.4"),e.setAttribute("stroke-dashoffset","0");const n=document.createElementNS("http://www.w3.org/2000/svg","animateTransform");return n.setAttribute("attributeName","transform"),n.setAttribute("attributeType","XML"),n.setAttribute("type","rotate"),n.setAttribute("from","0 12 12"),n.setAttribute("to","360 12 12"),n.setAttribute("dur","1s"),n.setAttribute("repeatCount","indefinite"),e.appendChild(n),t.appendChild(e),o.appendChild(t),o}createCheckmark(){const o=document.createElement("span");o.className="inline-checkmark";const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","14"),t.setAttribute("height","14"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.verticalAlign="middle";const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("d","M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"),e.setAttribute("fill","#34A853"),t.appendChild(e),o.appendChild(t),o}createCommandBadge(o){const t=document.createElement("div");t.className="command-badge-overlay",t.setAttribute("data-command",o);const e=document.createElement("div");return e.className="command-tracker-rect",Object.assign(e.style,{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",pointerEvents:"none",opacity:"0",zIndex:"-1"}),t.appendChild(e),new ResizeObserver(r=>{for(const m of r)m.target.getBoundingClientRect()}).observe(t),t}insertCommandBadge(o){try{const t=document.querySelector(".kix-cursor");if(!t)return;const n=window.getComputedStyle(t).transform,r=new DOMMatrixReadOnly(n),m=r.m41,d=r.m42;let h=0,p="",u=null,i=null,U=!1;const l=document.createElement("div");l.className="command-badge-overlay",Object.assign(l.style,{position:"absolute",left:`${m}px`,top:`${d}px`,zIndex:"9999999",display:"inline-flex",alignItems:"center",backgroundColor:"#f1f3f4",borderRadius:"3px",padding:"0 4px",margin:"0 1px",height:"20px",fontFamily:"'Google Sans', Roboto, Arial, sans-serif",fontSize:"14px",lineHeight:"20px",whiteSpace:"nowrap",pointerEvents:"all",cursor:"text",border:"1px solid transparent",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}),l.setAttribute("data-command",o);const B=document.createElement("span");Object.assign(B.style,{color:"#188038",fontWeight:"500",marginRight:"4px",userSelect:"none",pointerEvents:"none"}),B.textContent=o;const s=document.createElement("span");Object.assign(s.style,{color:"#444746",minWidth:"1px",outline:"none",whiteSpace:"pre",padding:"0 2px",position:"relative",zIndex:"10000000"}),s.contentEditable="true",s.dataset.placeholder="Parameter";const Z=()=>{requestAnimationFrame(()=>{const a=document.createRange(),w=window.getSelection();if(s.childNodes.length>0){const y=Array.from(s.childNodes).find(g=>g.nodeType===Node.TEXT_NODE)||s.childNodes[0];if(u!==null&&i!==null){const g=s.getBoundingClientRect(),q=u-g.left,x=document.createElement("span");x.style.font=window.getComputedStyle(s).font,x.style.visibility="hidden",x.style.position="absolute",this.waitForLoad(x);let T=0,D=1/0;for(let A=0;A<=y.textContent.length;A++){x.textContent=y.textContent.substring(0,A);const M=x.getBoundingClientRect().width,O=Math.abs(M-q);O<D&&(D=O,T=A)}document.body.removeChild(x),h=T}try{a.setStart(y,Math.min(h,y.length)),a.setEnd(y,Math.min(h,y.length))}catch{a.selectNodeContents(s),a.collapse(!1)}}else a.selectNodeContents(s),a.collapse(!1);w.removeAllRanges(),w.addRange(a)})};s.addEventListener("input",()=>{p=s.textContent;const a=window.getSelection();a.rangeCount>0&&(h=a.getRangeAt(0).startOffset)}),s.addEventListener("focus",()=>{U||(l.style.borderColor="#2563eb",l.style.boxShadow="0 0 0 2px rgba(37, 99, 235, 0.2)",Z())}),s.addEventListener("blur",a=>{if(!U)a.preventDefault(),requestAnimationFrame(()=>{s.focus()});else{const w=window.getSelection();w.rangeCount>0&&(h=w.getRangeAt(0).startOffset),l.style.borderColor="transparent",l.style.boxShadow="0 1px 3px rgba(0, 0, 0, 0.1)"}}),s.addEventListener("keydown",async a=>{if(a.key==="Enter"&&!a.shiftKey){a.preventDefault();const w=s.textContent.trim(),y=l.getBoundingClientRect(),g=window.getComputedStyle(l),q=y.width+parseFloat(g.paddingLeft)+parseFloat(g.paddingRight)+parseFloat(g.borderLeftWidth)+parseFloat(g.borderRightWidth),x=document.querySelector(".kix-cursor-caret"),T=parseFloat(window.getComputedStyle(x).height),D=Math.floor(29.98*Math.sqrt(.0586*T+1)-31.19),A=22.26*Math.exp(.03*D)-21.45,M=Math.ceil(q/A)+1,O="⠀".repeat(M);l.style.opacity="0.5",l.style.pointerEvents="none",s.contentEditable="false",s.style.userSelect="none";const ee=this.createSpinner();l.appendChild(ee),await new Promise(C=>requestAnimationFrame(C));const F={...{x:y.right,y:y.top}},c=document.querySelector(".docs-texteventtarget-iframe").contentDocument.querySelector('div[aria-label="Document content"]'),me=s.onfocus,he=s.onblur;s.onfocus=null,s.onblur=null,c.focus(),s.addEventListener("focus",C=>{C.preventDefault(),c.focus()},{once:!0});try{const C=new DataTransfer;C.setData("text/plain",O),c.dispatchEvent(new KeyboardEvent("keydown",{key:" ",code:"Space",keyCode:32,which:32,bubbles:!0,cancelable:!0})),c.dispatchEvent(new KeyboardEvent("keypress",{key:" ",code:"Space",keyCode:32,which:32,bubbles:!0,cancelable:!0,charCode:32})),c.dispatchEvent(new InputEvent("beforeinput",{inputType:"insertText",data:" ",bubbles:!0,cancelable:!0})),c.dispatchEvent(new KeyboardEvent("keyup",{key:" ",code:"Space",keyCode:32,which:32,bubbles:!0,cancelable:!0})),c.dispatchEvent(new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:C}));const S=await this.processCommand(o,w);l.remove(),requestAnimationFrame(async()=>{const $=document.querySelector(".kix-rotatingtilemanager-content");$.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,clientX:F.x,clientY:F.y})),$.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,clientX:F.x,clientY:F.y})),c.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowRight",code:"ArrowRight",keyCode:39,which:39,shiftKey:!0,bubbles:!0,cancelable:!0})),c.dispatchEvent(new KeyboardEvent("keyup",{key:"ArrowRight",code:"ArrowRight",keyCode:39,which:39,shiftKey:!0,bubbles:!0,cancelable:!0}));const G=new DataTransfer;if(c.dispatchEvent(new ClipboardEvent("copy",{bubbles:!0,cancelable:!0,clipboardData:G})),G.getData("text/plain")==="⠀"&&(c.dispatchEvent(new KeyboardEvent("keydown",{key:"Backspace",code:"Backspace",keyCode:8,which:8,bubbles:!0,cancelable:!0})),c.dispatchEvent(new KeyboardEvent("keyup",{key:"Backspace",code:"Backspace",keyCode:8,which:8,bubbles:!0,cancelable:!0}))),c.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowLeft",code:"ArrowLeft",keyCode:37,which:37,ctrlKey:!0,shiftKey:!0,bubbles:!0,cancelable:!0})),c.dispatchEvent(new KeyboardEvent("keyup",{key:"ArrowLeft",code:"ArrowLeft",keyCode:37,which:37,ctrlKey:!0,shiftKey:!0,bubbles:!0,cancelable:!0})),c.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowLeft",code:"ArrowLeft",keyCode:37,which:37,shiftKey:!0,bubbles:!0,cancelable:!0})),c.dispatchEvent(new KeyboardEvent("keyup",{key:"ArrowLeft",code:"ArrowLeft",keyCode:37,which:37,shiftKey:!0,bubbles:!0,cancelable:!0})),S){const W=new DataTransfer;W.setData("text/plain",S),new Promise(v=>{let I=0;const N=10;function L(){const b=[];return document.querySelectorAll("div.kix-canvas-tile-content > svg").forEach(H=>{H.querySelectorAll("g[role='paragraph'] rect, g[data-section-type='body'] rect").forEach(E=>{const R=E.getAttribute("aria-label");if(R&&(R===S||R.includes(S))){const te=parseFloat(E.getAttribute("x")),ne=parseFloat(E.getAttribute("y")),X=parseFloat(E.getAttribute("height")),Y=E.getAttribute("transform");let _=0,Q=0;if(Y){const K=Y.match(/matrix\(.*?,.*?,.*?,.*?,(.*?),(.*?)\)/);K&&(_=parseFloat(K[1])||0,Q=parseFloat(K[2])||0)}const oe=te+_,J=ne+Q,P=document.createElement("canvas").getContext("2d"),se=window.getComputedStyle(E).font||"14px Arial";P.font=se;const ae=R.substring(0,R.indexOf(S)),re=P.measureText(ae).width,ie=P.measureText(S).width,V=oe+re,de=V+ie,le=J+X-2;b.push({rect:E,svg:H,text:R,positions:{x1:V,x2:de,y1:le,startY:J,height:X}})}})}),b}function f(){I++;const b=L();if(b.length>0){v(b);return}I<N?setTimeout(f,Math.min(100*Math.pow(2,I),1e3)):v(null)}c.dispatchEvent(new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:W})),setTimeout(f,50)}).then(v=>{if(v&&v.length>0){const I=v[0].svg,N=I.querySelector('g[data-enhanced-text-tracker="underline-group"]'),L=document.createElementNS("http://www.w3.org/2000/svg","g");if(L.setAttribute("data-enhanced-text-tracker","pulse-group"),v.forEach(({positions:f})=>{const b=document.createElementNS("http://www.w3.org/2000/svg","rect");b.setAttribute("x",f.x1.toString()),b.setAttribute("y",f.startY.toString()),b.setAttribute("width",(f.x2-f.x1).toString()),b.setAttribute("height",f.height.toString()),b.setAttribute("class","pulse-animation"),b.style.pointerEvents="none",L.appendChild(b)}),!document.getElementById("pulse-animation-style")){const f=document.createElement("style");f.id="pulse-animation-style",f.textContent=`
                          @keyframes textPulse {
                            0% { fill: rgba(33, 150, 243, 0.4); }
                            100% { fill: rgba(33, 150, 243, 0); }
                          }
                          .pulse-animation {
                            animation: textPulse 1s ease-out;
                            pointer-events: none;
                          }
                        `,document.head.appendChild(f)}I.insertBefore(L,N),setTimeout(()=>{L.remove()},1e3)}})}c.focus()})}catch{l.remove(),requestAnimationFrame(async()=>{c.focus()})}}}),l.addEventListener("mousedown",a=>{a.stopPropagation(),u=a.clientX,i=a.clientY,(a.target===s||a.target===l)&&s.focus()}),l.addEventListener("mouseleave",()=>{u=null,i=null}),document.addEventListener("mousedown",a=>{l.contains(a.target)||(U=!0)}),document.addEventListener("mouseup",a=>{U&&!l.contains(a.target)&&s.blur(),U=!1});const z=document.createElement("style");z.textContent=`
          [data-placeholder]:empty:before {
            content: attr(data-placeholder);
            color: #5f6368;
            font-style: italic;
            pointer-events: none;
          }
        `,document.head.appendChild(z),l.appendChild(B),l.appendChild(s);const j=document.querySelector(".kix-appview-editor");if(!j)return;let k=document.querySelector(".command-overlay-container");k||(k=document.createElement("div"),k.className="command-overlay-container",Object.assign(k.style,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",zIndex:"9999997",pointerEvents:"none"}),j.appendChild(k)),k.appendChild(l),requestAnimationFrame(()=>{s.focus()}),document.execCommand("delete",!1)}catch{}}async processCommand(o,t){try{if(!document.querySelector(".kix-cursor"))return null;if(o==="/synonym")try{const n=await fetch(`https://backend.factful.io/get-syn?word=${encodeURIComponent(t)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const r=await n.json();if(r.synonyms&&r.synonyms.length>0){const m=document.querySelector(".command-badge-overlay"),d=document.createElement("div");return Object.assign(d.style,{position:"absolute",left:`${m.getBoundingClientRect().right}px`,top:`${m.getBoundingClientRect().bottom+5}px`,backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08)",padding:"8px",zIndex:"1000000",display:"flex",flexDirection:"column",gap:"4px",border:"1px solid #e0e0e0"}),new Promise(h=>{r.synonyms.forEach(u=>{const i=document.createElement("button");Object.assign(i.style,{padding:"8px 12px",border:"none",borderRadius:"4px",backgroundColor:"#f3f4f6",cursor:"pointer",textAlign:"left",width:"100%",color:"#374151",fontFamily:"'Google Sans', Roboto, Arial, sans-serif",fontSize:"14px",transition:"background-color 0.2s"}),i.textContent=u,i.addEventListener("mouseover",()=>{i.style.backgroundColor="#e5e7eb"}),i.addEventListener("mouseout",()=>{i.style.backgroundColor="#f3f4f6"}),i.addEventListener("click",()=>{d.remove(),h(u)}),d.appendChild(i)}),this.waitForLoad(d);const p=u=>{d.contains(u.target)||(d.remove(),document.removeEventListener("mousedown",p),h(null))};document.addEventListener("mousedown",p)})}}catch{return null}else if(o==="/antonym")try{const n=await fetch(`https://backend.factful.io/get-ant?word=${encodeURIComponent(t)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const r=await n.json();if(r.antonyms&&r.antonyms.length>0){const m=document.querySelector(".command-badge-overlay"),d=document.createElement("div");return Object.assign(d.style,{position:"absolute",left:`${m.getBoundingClientRect().right}px`,top:`${m.getBoundingClientRect().bottom+5}px`,backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08)",padding:"8px",zIndex:"1000000",display:"flex",flexDirection:"column",gap:"4px",border:"1px solid #e0e0e0"}),new Promise(h=>{r.antonyms.forEach(u=>{const i=document.createElement("button");Object.assign(i.style,{padding:"8px 12px",border:"none",borderRadius:"4px",backgroundColor:"#f3f4f6",cursor:"pointer",textAlign:"left",width:"100%",color:"#374151",fontFamily:"'Google Sans', Roboto, Arial, sans-serif",fontSize:"14px",transition:"background-color 0.2s"}),i.textContent=u,i.addEventListener("mouseover",()=>{i.style.backgroundColor="#e5e7eb"}),i.addEventListener("mouseout",()=>{i.style.backgroundColor="#f3f4f6"}),i.addEventListener("click",()=>{d.remove(),h(u)}),d.appendChild(i)}),this.waitForLoad(d);const p=u=>{d.contains(u.target)||(d.remove(),document.removeEventListener("mousedown",p),h(null))};document.addEventListener("mousedown",p)})}}catch{return null}else if(o==="/search")try{const n=await fetch(`https://backend.factful.io/quick_search/${encodeURIComponent(t)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const r=await n.json();if(r.output){const m=document.querySelector(".command-badge-overlay"),d=document.createElement("div");return Object.assign(d.style,{position:"absolute",left:`${m.getBoundingClientRect().right}px`,top:`${m.getBoundingClientRect().bottom+5}px`,backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08)",padding:"8px",zIndex:"1000000",display:"flex",flexDirection:"column",gap:"4px",border:"1px solid #e0e0e0",maxWidth:"400px"}),new Promise(h=>{const p=document.createElement("button");Object.assign(p.style,{padding:"8px 12px",border:"none",borderRadius:"4px",backgroundColor:"#f3f4f6",cursor:"pointer",textAlign:"left",width:"100%",color:"#374151",fontFamily:"'Google Sans', Roboto, Arial, sans-serif",fontSize:"14px",transition:"background-color 0.2s",whiteSpace:"pre-wrap",wordBreak:"break-word",lineHeight:"1.5"}),p.textContent=r.output,p.addEventListener("mouseover",()=>{p.style.backgroundColor="#e5e7eb"}),p.addEventListener("mouseout",()=>{p.style.backgroundColor="#f3f4f6"}),p.addEventListener("click",()=>{d.remove(),h(r.output)}),d.appendChild(p),this.waitForLoad(d);const u=i=>{d.contains(i.target)||(d.remove(),document.removeEventListener("mousedown",u),h(null))};document.addEventListener("mousedown",u)})}}catch{return null}return null}catch{return null}}}export{we as SlashCommand};
